<!DOCTYPE html>
<html lang="en">
<head>
Â  <meta charset="UTF-8">
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  <title>KageAI - Your AI Assistant</title>
Â  Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/2.1.0/showdown.min.js"></script>
Â  <style>
Â  Â  /* Reset & Base */
Â  Â  * {
Â  Â  Â  margin: 0;
Â  Â  Â  padding: 0;
Â  Â  Â  box-sizing: border-box;
Â  Â  }

Â  Â  body {
Â  Â  Â  font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
Â  Â  Â  background: #000000;
Â  Â  Â  color: #ffffff;
Â  Â  Â  min-height: 100vh;
Â  Â  Â  display: flex;
Â  Â  Â  justify-content: center;
Â  Â  Â  align-items: center;
Â  Â  Â  padding: 20px;
Â  Â  }

Â  Â  /* Container */
Â  Â  .container {
Â  Â  Â  max-width: 900px;
Â  Â  Â  width: 100%;
Â  Â  Â  display: flex;
Â  Â  Â  flex-direction: column;
Â  Â  Â  height: 90vh;
Â  Â  Â  max-height: 800px;
Â  Â  }

Â  Â  /* Header */
Â  Â  .header {
Â  Â  Â  text-align: center;
Â  Â  Â  margin-bottom: 1.5rem;
Â  Â  }

Â  Â  .logo {
Â  Â  Â  font-size: 3rem;
Â  Â  Â  font-weight: 900;
Â  Â  Â  background: linear-gradient(135deg, #22d3ee, #a855f7);
Â  Â  Â  background-clip: text;
Â  Â  Â  -webkit-background-clip: text;
Â  Â  Â  -webkit-text-fill-color: transparent;
Â  Â  Â  margin-bottom: 0.5rem;
Â  Â  }

Â  Â  .tagline {
Â  Â  Â  color: #888;
Â  Â  Â  font-size: 1rem;
Â  Â  Â  margin-bottom: 0.5rem;
Â  Â  }

Â  Â  .header-actions {
Â  Â  Â  display: flex;
Â  Â  Â  gap: 8px;
Â  Â  Â  justify-content: center;
Â  Â  Â  margin-top: 12px;
Â  Â  }

Â  Â  .header-btn {
Â  Â  Â  padding: 6px 14px;
Â  Â  Â  background: rgba(255,255,255,0.05);
Â  Â  Â  border: 1px solid rgba(255,255,255,0.1);
Â  Â  Â  border-radius: 8px;
Â  Â  Â  color: #888;
Â  Â  Â  cursor: pointer;
Â  Â  Â  font-size: 0.85rem;
Â  Â  Â  transition: all 0.3s;
Â  Â  }

Â  Â  .header-btn:hover {
Â  Â  Â  background: rgba(255,255,255,0.08);
Â  Â  Â  border-color: rgba(255,255,255,0.2);
Â  Â  Â  color: #fff;
Â  Â  }

Â  Â  .clear-btn:hover {
Â  Â  Â  border-color: #ff4444;
Â  Â  Â  color: #ff4444;
Â  Â  }

Â  Â  /* Quick Actions Bar */
Â  Â  .quick-actions {
Â  Â  Â  display: flex;
Â  Â  Â  gap: 8px;
Â  Â  Â  margin-bottom: 1rem;
Â  Â  Â  flex-wrap: wrap;
Â  Â  Â  justify-content: center;
Â  Â  }

Â  Â  .quick-action {
Â  Â  Â  padding: 8px 16px;
Â  Â  Â  background: rgba(34, 211, 238, 0.1);
Â  Â  Â  border: 1px solid rgba(34, 211, 238, 0.2);
Â  Â  Â  border-radius: 20px;
Â  Â  Â  color: #22d3ee;
Â  Â  Â  font-size: 0.9rem;
Â  Â  Â  cursor: pointer;
Â  Â  Â  transition: all 0.3s;
Â  Â  Â  white-space: nowrap;
Â  Â  }

Â  Â  .quick-action:hover {
Â  Â  Â  background: rgba(34, 211, 238, 0.2);
Â  Â  Â  border-color: #22d3ee;
Â  Â  Â  transform: translateY(-2px);
Â  Â  }

Â  Â  /* Chat Box */
Â  Â  .chat-box {
Â  Â  Â  flex: 1;
Â  Â  Â  background: rgba(255, 255, 255, 0.03);
Â  Â  Â  border: 1px solid rgba(255, 255, 255, 0.1);
Â  Â  Â  border-radius: 16px;
Â  Â  Â  padding: 20px;
Â  Â  Â  overflow-y: auto;
Â  Â  Â  margin-bottom: 1rem;
Â  Â  Â  display: flex;
Â  Â  Â  flex-direction: column;
Â  Â  Â  gap: 1rem;
Â  Â  }

Â  Â  /* Scrollbar styling */
Â  Â  .chat-box::-webkit-scrollbar {
Â  Â  Â  width: 8px;
Â  Â  }

Â  Â  .chat-box::-webkit-scrollbar-track {
Â  Â  Â  background: transparent;
Â  Â  }

Â  Â  .chat-box::-webkit-scrollbar-thumb {
Â  Â  Â  background: rgba(255, 255, 255, 0.1);
Â  Â  Â  border-radius: 4px;
Â  Â  }

Â  Â  .chat-box::-webkit-scrollbar-thumb:hover {
Â  Â  Â  background: rgba(255, 255, 255, 0.2);
Â  Â  }

Â  Â  /* Messages */
Â  Â  .message {
Â  Â  Â  display: flex;
Â  Â  Â  gap: 12px;
Â  Â  Â  animation: slideIn 0.3s ease;
Â  Â  }

Â  Â  @keyframes slideIn {
Â  Â  Â  from {
Â  Â  Â  Â  opacity: 0;
Â  Â  Â  Â  transform: translateY(10px);
Â  Â  Â  }
Â  Â  Â  to {
Â  Â  Â  Â  opacity: 1;
Â  Â  Â  Â  transform: translateY(0);
Â  Â  Â  }
Â  Â  }

Â  Â  .message-content {
Â  Â  Â  max-width: 80%;
Â  Â  Â  padding: 12px 16px;
Â  Â  Â  border-radius: 12px;
Â  Â  Â  line-height: 1.6;
Â  Â  Â  word-wrap: break-word;
Â  Â  Â  overflow-x: auto; /* For code blocks */
Â  Â  }

Â  Â  .user-message {
Â  Â  Â  flex-direction: row-reverse;
Â  Â  }

Â  Â  .user-message .message-content {
Â  Â  Â  background: linear-gradient(135deg, #22d3ee, #3b82f6);
Â  Â  Â  margin-left: auto;
Â  Â  }

Â  Â  .ai-message .message-content {
Â  Â  Â  background: rgba(168, 85, 247, 0.1);
Â  Â  Â  border: 1px solid rgba(168, 85, 247, 0.2);
Â  Â  }
Â  Â  
Â  Â  /* Markdown rendering styles for AI messages */
Â  Â  .ai-message .message-content p {
Â  Â  Â  margin-top: 0.5em;
Â  Â  Â  margin-bottom: 0.5em;
Â  Â  }
Â  Â  
Â  Â  .ai-message .message-content pre {
Â  Â  Â  background: rgba(0,0,0,0.5);
Â  Â  Â  border-radius: 6px;
Â  Â  Â  padding: 10px;
Â  Â  Â  overflow-x: auto;
Â  Â  Â  margin-top: 10px;
Â  Â  Â  margin-bottom: 10px;
Â  Â  }
Â  Â  
Â  Â  .ai-message .message-content code {
Â  Â  Â  font-family: monospace;
Â  Â  Â  font-size: 0.95em;
Â  Â  }
Â  Â  
Â  Â  .ai-message .message-content pre code {
Â  Â  Â  display: block;
Â  Â  Â  padding: 0;
Â  Â  Â  color: #fff;
Â  Â  Â  background: transparent;
Â  Â  Â  white-space: pre;
Â  Â  }
Â  Â  
Â  Â  .ai-message .message-content ul, .ai-message .message-content ol {
Â  Â  Â  margin: 10px 0 10px 20px;
Â  Â  Â  padding: 0;
Â  Â  }
Â  Â  
Â  Â  .ai-message .message-content li {
Â  Â  Â  margin-bottom: 5px;
Â  Â  }

Â  Â  .avatar {
Â  Â  Â  width: 36px;
Â  Â  Â  height: 36px;
Â  Â  Â  border-radius: 50%;
Â  Â  Â  display: flex;
Â  Â  Â  align-items: center;
Â  Â  Â  justify-content: center;
Â  Â  Â  font-size: 1.2rem;
Â  Â  Â  flex-shrink: 0;
Â  Â  }

Â  Â  .user-avatar {
Â  Â  Â  background: linear-gradient(135deg, #22d3ee, #3b82f6);
Â  Â  }

Â  Â  .ai-avatar {
Â  Â  Â  background: linear-gradient(135deg, #a855f7, #ec4899);
Â  Â  }

Â  Â  /* Loading animation */
Â  Â  .typing-indicator {
Â  Â  Â  display: flex;
Â  Â  Â  gap: 4px;
Â  Â  Â  padding: 8px;
Â  Â  }

Â  Â  .typing-dot {
Â  Â  Â  width: 8px;
Â  Â  Â  height: 8px;
Â  Â  Â  border-radius: 50%;
Â  Â  Â  background: #888;
Â  Â  Â  animation: typing 1.4s infinite;
Â  Â  }

Â  Â  .typing-dot:nth-child(2) {
Â  Â  Â  animation-delay: 0.2s;
Â  Â  }

Â  Â  .typing-dot:nth-child(3) {
Â  Â  Â  animation-delay: 0.4s;
Â  Â  }

Â  Â  @keyframes typing {
Â  Â  Â  0%, 60%, 100% {
Â  Â  Â  Â  opacity: 0.3;
Â  Â  Â  }
Â  Â  Â  30% {
Â  Â  Â  Â  opacity: 1;
Â  Â  Â  }
Â  Â  }

Â  Â  /* Input Area */
Â  Â  .input-area {
Â  Â  Â  display: flex;
Â  Â  Â  gap: 12px;
Â  Â  Â  background: rgba(255, 255, 255, 0.05);
Â  Â  Â  border: 1px solid rgba(255, 255, 255, 0.1);
Â  Â  Â  border-radius: 12px;
Â  Â  Â  padding: 12px;
Â  Â  Â  transition: border-color 0.3s;
Â  Â  }

Â  Â  .input-area:focus-within {
Â  Â  Â  border-color: #22d3ee;
Â  Â  }

Â  Â  #messageInput {
Â  Â  Â  flex: 1;
Â  Â  Â  background: transparent;
Â  Â  Â  border: none;
Â  Â  Â  color: #fff;
Â  Â  Â  font-size: 16px;
Â  Â  Â  outline: none;
Â  Â  }

Â  Â  #messageInput::placeholder {
Â  Â  Â  color: #666;
Â  Â  }

Â  Â  #sendButton {
Â  Â  Â  background: linear-gradient(135deg, #22d3ee, #3b82f6);
Â  Â  Â  border: none;
Â  Â  Â  color: #fff;
Â  Â  Â  padding: 12px 24px;
Â  Â  Â  border-radius: 8px;
Â  Â  Â  font-weight: 600;
Â  Â  Â  cursor: pointer;
Â  Â  Â  transition: transform 0.2s, box-shadow 0.2s;
Â  Â  }

Â  Â  #sendButton:hover {
Â  Â  Â  transform: translateY(-2px);
Â  Â  Â  box-shadow: 0 8px 20px rgba(34, 211, 238, 0.3);
Â  Â  }

Â  Â  #sendButton:active {
Â  Â  Â  transform: translateY(0);
Â  Â  }

Â  Â  #sendButton:disabled {
Â  Â  Â  opacity: 0.5;
Â  Â  Â  cursor: not-allowed;
Â  Â  Â  transform: none;
Â  Â  }

Â  Â  /* Empty state */
Â  Â  .empty-state {
Â  Â  Â  display: flex;
Â  Â  Â  flex-direction: column;
Â  Â  Â  align-items: center;
Â  Â  Â  justify-content: center;
Â  Â  Â  height: 100%;
Â  Â  Â  color: #666;
Â  Â  Â  text-align: center;
Â  Â  Â  gap: 1rem;
Â  Â  }

Â  Â  .empty-state-icon {
Â  Â  Â  font-size: 4rem;
Â  Â  }

Â  Â  /* Suggestions */
Â  Â  .suggestions {
Â  Â  Â  display: grid;
Â  Â  Â  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
Â  Â  Â  gap: 12px;
Â  Â  Â  margin-top: 1rem;
Â  Â  }

Â  Â  .suggestion-card {
Â  Â  Â  background: rgba(255, 255, 255, 0.05);
Â  Â  Â  border: 1px solid rgba(255, 255, 255, 0.1);
Â  Â  Â  border-radius: 12px;
Â  Â  Â  padding: 16px;
Â  Â  Â  cursor: pointer;
Â  Â  Â  transition: all 0.3s;
Â  Â  }

Â  Â  .suggestion-card:hover {
Â  Â  Â  background: rgba(255, 255, 255, 0.08);
Â  Â  Â  border-color: #22d3ee;
Â  Â  Â  transform: translateY(-2px);
Â  Â  }

Â  Â  .suggestion-title {
Â  Â  Â  font-weight: 600;
Â  Â  Â  margin-bottom: 4px;
Â  Â  Â  color: #22d3ee;
Â  Â  }

Â  Â  .suggestion-desc {
Â  Â  Â  font-size: 0.9rem;
Â  Â  Â  color: #888;
Â  Â  }

Â  Â  /* Status indicator */
Â  Â  .status {
Â  Â  Â  position: fixed;
Â  Â  Â  bottom: 20px;
Â  Â  Â  right: 20px;
Â  Â  Â  padding: 8px 16px;
Â  Â  Â  background: rgba(0,0,0,0.8);
Â  Â  Â  border: 1px solid rgba(255,255,255,0.1);
Â  Â  Â  border-radius: 8px;
Â  Â  Â  font-size: 0.85rem;
Â  Â  Â  color: #888;
Â  Â  Â  display: none;
Â  Â  }

Â  Â  .status.show {
Â  Â  Â  display: block;
Â  Â  Â  animation: fadeIn 0.3s;
Â  Â  }

Â  Â  @keyframes fadeIn {
Â  Â  Â  from { opacity: 0; }
Â  Â  Â  to { opacity: 1; }
Â  Â  }

Â  Â  /* Mobile responsive */
Â  Â  @media (max-width: 768px) {
Â  Â  Â  .logo {
Â  Â  Â  Â  font-size: 2.5rem;
Â  Â  Â  }

Â  Â  Â  .quick-actions {
Â  Â  Â  Â  gap: 6px;
Â  Â  Â  }

Â  Â  Â  .quick-action {
Â  Â  Â  Â  font-size: 0.85rem;
Â  Â  Â  Â  padding: 6px 12px;
Â  Â  Â  }

Â  Â  Â  .message-content {
Â  Â  Â  Â  max-width: 85%;
Â  Â  Â  }
Â  Â  }
Â  </style>
</head>
<body>
Â  <div class="container">
Â  Â  Â  Â  <div class="header">
Â  Â  Â  <div class="logo">ğŸš€ KageAI</div>
Â  Â  Â  <div class="tagline">Your AI-Powered Productivity Assistant</div>
Â  Â  Â  <div class="header-actions">
Â  Â  Â  Â  <button onclick="exportChat()" class="header-btn">
Â  Â  Â  Â  Â  ğŸ’¾ Export
Â  Â  Â  Â  </button>
Â  Â  Â  Â  <button onclick="clearChat()" class="header-btn clear-btn">
Â  Â  Â  Â  Â  ğŸ—‘ï¸ Clear Chat
Â  Â  Â  Â  </button>
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  Â  Â  <div class="quick-actions">
Â  Â  Â  <button onclick="sendSuggestion('What are my top 3 priorities today?')" class="quick-action">
Â  Â  Â  Â  ğŸ¯ Priorities
Â  Â  Â  </button>
Â  Â  Â  <button onclick="sendSuggestion('Help me break down this project into tasks')" class="quick-action">
Â  Â  Â  Â  ğŸ“‹ Plan Project
Â  Â  Â  </button>
Â  Â  Â  <button onclick="sendSuggestion('Give me a 5-minute productivity boost')" class="quick-action">
Â  Â  Â  Â  âš¡ Quick Win
Â  Â  Â  </button>
Â  Â  Â  <button onclick="sendSuggestion('Summarize my conversation so far')" class="quick-action">
Â  Â  Â  Â  ğŸ“Š Summary
Â  Â  Â  </button>
Â  Â  </div>

Â  Â  Â  Â  <div class="chat-box" id="chatBox">
Â  Â  Â  Â  Â  Â  <div class="empty-state" id="emptyState">
Â  Â  Â  Â  <div class="empty-state-icon">ğŸ’¬</div>
Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  <h2>Welcome to KageAI!</h2>
Â  Â  Â  Â  Â  <p>Your AI productivity partner for getting things done</p>
Â  Â  Â  Â  </div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <div class="suggestions">
Â  Â  Â  Â  Â  <div class="suggestion-card" onclick="sendSuggestion('What can you help me with?')">
Â  Â  Â  Â  Â  Â  <div class="suggestion-title">âœ¨ Getting Started</div>
Â  Â  Â  Â  Â  Â  <div class="suggestion-desc">Learn what I can do</div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="suggestion-card" onclick="sendSuggestion('Help me prioritize my tasks for today')">
Â  Â  Â  Â  Â  Â  <div class="suggestion-title">ğŸ“‹ Task Help</div>
Â  Â  Â  Â  Â  Â  <div class="suggestion-desc">Organize your work</div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="suggestion-card" onclick="sendSuggestion('I need help staying focused')">
Â  Â  Â  Â  Â  Â  <div class="suggestion-title">ğŸ’¡ Productivity</div>
Â  Â  Â  Â  Â  Â  <div class="suggestion-desc">Boost your efficiency</div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  Â  Â  <div class="input-area">
Â  Â  Â  <inputÂ 
Â  Â  Â  Â  type="text"Â 
Â  Â  Â  Â  id="messageInput"Â 
Â  Â  Â  Â  placeholder="Type your message... (Press Enter to send)"
Â  Â  Â  Â  autocomplete="off"
Â  Â  Â  >
Â  Â  Â  <button id="sendButton">Send</button>
Â  Â  </div>
Â  </div>

Â  Â  <div id="status" class="status"></div>

Â  <script>
Â  Â  // Configuration
Â  Â  const API_URL = 'https://kageai-backend.kagelabs.deno.net'; // Change to your Deno Deploy URL when deploying

Â  Â  // DOM Elements
Â  Â  const chatBox = document.getElementById('chatBox');
Â  Â  const emptyState = document.getElementById('emptyState');
Â  Â  const messageInput = document.getElementById('messageInput');
Â  Â  const sendButton = document.getElementById('sendButton');
Â  Â  const statusDiv = document.getElementById('status');

Â  Â  // Initialize Showdown converter
Â  Â  const converter = new showdown.Converter({
Â  Â  Â  // Enable common extensions for better rendering
Â  Â  Â  tables: true,
Â  Â  Â  strikethrough: true,
Â  Â  Â  tasklists: true,
Â  Â  Â  simplifiedAutoLink: true
Â  Â  });

Â  Â  // State
Â  Â  let isWaitingForResponse = false;
Â  Â  let chatHistory = [];

Â  Â  // Load chat history from localStorage
Â  Â  function loadChatHistory() {
Â  Â  Â  const saved = localStorage.getItem('kageai_chat_history');
Â  Â  Â  if (saved) {
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  chatHistory = JSON.parse(saved);
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  // Display saved messages
Â  Â  Â  Â  Â  if (chatHistory.length > 0) {
Â  Â  Â  Â  Â  Â  emptyState.style.display = 'none';
Â  Â  Â  Â  Â  Â  chatHistory.forEach(msg => {
Â  Â  Â  Â  Â  Â  Â  addMessageToUI(msg.content, msg.isUser, false);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  showStatus(`Loaded ${chatHistory.length} messages from history`);
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  console.error('Error loading chat history:', error);
Â  Â  Â  Â  Â  chatHistory = [];
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  }

Â  Â  // Save chat history to localStorage
Â  Â  function saveChatHistory() {
Â  Â  Â  try {
Â  Â  Â  Â  localStorage.setItem('kageai_chat_history', JSON.stringify(chatHistory));
Â  Â  Â  } catch (error) {
Â  Â  Â  Â  console.error('Error saving chat history:', error);
Â  Â  Â  Â  showStatus('Error saving chat history', true);
Â  Â  Â  }
Â  Â  }

Â  Â  // Show status message
Â  Â  function showStatus(message, isError = false) {
Â  Â  Â  statusDiv.textContent = message;
Â  Â  Â  statusDiv.style.color = isError ? '#ff4444' : '#22d3ee';
Â  Â  Â  statusDiv.classList.add('show');
Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  statusDiv.classList.remove('show');
Â  Â  Â  }, 3000);
Â  Â  }

Â  Â  // Clear chat history
Â  Â  window.clearChat = function() { // Make function globally accessible
Â  Â  Â  if (confirm('Clear all chat history? This cannot be undone.')) {
Â  Â  Â  Â  chatHistory = [];
Â  Â  Â  Â  localStorage.removeItem('kageai_chat_history');
Â  Â  Â  Â  chatBox.innerHTML = '';
Â  Â  Â  Â  const emptyStateClone = document.getElementById('emptyState').cloneNode(true);
Â  Â  Â  Â  chatBox.appendChild(emptyStateClone);
Â  Â  Â  Â  emptyState.style.display = 'flex';
Â  Â  Â  Â  showStatus('Chat history cleared');
Â  Â  Â  }
Â  Â  }

Â  Â  // Export chat history
Â  Â  window.exportChat = function() { // Make function globally accessible
Â  Â  Â  if (chatHistory.length === 0) {
Â  Â  Â  Â  showStatus('No messages to export', true);
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  const exportData = {
Â  Â  Â  Â  exported: new Date().toISOString(),
Â  Â  Â  Â  messageCount: chatHistory.length,
Â  Â  Â  Â  messages: chatHistory
Â  Â  Â  };

Â  Â  Â  const dataStr = JSON.stringify(exportData, null, 2);
Â  Â  Â  const dataBlob = new Blob([dataStr], { type: 'application/json' });
Â  Â  Â  const url = URL.createObjectURL(dataBlob);
Â  Â  Â  const link = document.createElement('a');
Â  Â  Â  link.href = url;
Â  Â  Â  link.download = `kageai-chat-${new Date().toISOString().split('T')[0]}.json`;
Â  Â  Â  link.click();
Â  Â  Â  URL.revokeObjectURL(url);
Â  Â  Â  showStatus('Chat exported successfully');
Â  Â  }

Â  Â  // Add message to UI only
Â  Â  function addMessageToUI(content, isUser = false, animate = true) {
Â  Â  Â  if (emptyState) {
Â  Â  Â  Â  emptyState.style.display = 'none';
Â  Â  Â  }

Â  Â  Â  const messageDiv = document.createElement('div');
Â  Â  Â  messageDiv.className = `message ${isUser ? 'user-message' : 'ai-message'}`;
Â  Â  Â  if (!animate) messageDiv.style.animation = 'none';

Â  Â  Â  let innerContent;
Â  Â  Â  if (isUser) {
Â  Â  Â  Â  // Simple formatting for user messages (line breaks only)
Â  Â  Â  Â  innerContent = content.replace(/\n/g, '<br>');
Â  Â  Â  } else {
Â  Â  Â  Â  // Convert Markdown to HTML for AI messages
Â  Â  Â  Â  innerContent = converter.makeHtml(content);
Â  Â  Â  }
Â  Â  Â Â 
Â  Â  Â  messageDiv.innerHTML = `
Â  Â  Â  Â  <div class="avatar ${isUser ? 'user-avatar' : 'ai-avatar'}">
Â  Â  Â  Â  Â  ${isUser ? 'ğŸ‘¤' : 'ğŸ¤–'}
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="message-content">${innerContent}</div>
Â  Â  Â  `;
Â  Â  Â Â 
Â  Â  Â  chatBox.appendChild(messageDiv);
Â  Â  Â  chatBox.scrollTop = chatBox.scrollHeight;
Â  Â  }

Â  Â  // Add message and save to history
Â  Â  function addMessage(content, isUser = false) {
Â  Â  Â  addMessageToUI(content, isUser, true);
Â  Â  Â Â 
Â  Â  Â  // Save to history (save the original markdown/text)
Â  Â  Â  chatHistory.push({
Â  Â  Â  Â  content: content,
Â  Â  Â  Â  isUser: isUser,
Â  Â  Â  Â  timestamp: new Date().toISOString()
Â  Â  Â  });
Â  Â  Â  saveChatHistory();
Â  Â  }

Â  Â  // Show typing indicator
Â  Â  function showTyping() {
Â  Â  Â  const typingDiv = document.createElement('div');
Â  Â  Â  typingDiv.className = 'message ai-message';
Â  Â  Â  typingDiv.id = 'typing-indicator';
Â  Â  Â  typingDiv.innerHTML = `
Â  Â  Â  Â  <div class="avatar ai-avatar">ğŸ¤–</div>
Â  Â  Â  Â  <div class="message-content">
Â  Â  Â  Â  Â  <div class="typing-indicator">
Â  Â  Â  Â  Â  Â  <div class="typing-dot"></div>
Â  Â  Â  Â  Â  Â  <div class="typing-dot"></div>
Â  Â  Â  Â  Â  Â  <div class="typing-dot"></div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  `;
Â  Â  Â  chatBox.appendChild(typingDiv);
Â  Â  Â  chatBox.scrollTop = chatBox.scrollHeight;
Â  Â  }

Â  Â  // Remove typing indicator
Â  Â  function hideTyping() {
Â  Â  Â  const typing = document.getElementById('typing-indicator');
Â  Â  Â  if (typing) typing.remove();
Â  Â  }

Â  Â  // Send message to API with context
Â  Â  async function sendMessage(message) {
Â  Â  Â  if (!message.trim() || isWaitingForResponse) return;

Â  Â  Â  // Add user message
Â  Â  Â  addMessage(message, true);
Â  Â  Â  messageInput.value = '';
Â  Â  Â Â 
Â  Â  Â  // Disable input while waiting
Â  Â  Â  isWaitingForResponse = true;
Â  Â  Â  sendButton.disabled = true;
Â  Â  Â  messageInput.disabled = true;
Â  Â  Â Â 
Â  Â  Â  // Show typing indicator
Â  Â  Â  showTyping();

Â  Â  Â  try {
Â  Â  Â  Â  // Send recent context (last 10 messages) to maintain conversation flow
Â  Â  Â  Â  const recentHistory = chatHistory.slice(-10).map(msg => ({
Â  Â  Â  Â  Â  role: msg.isUser ? 'user' : 'assistant',
Â  Â  Â  Â  Â  content: msg.content
Â  Â  Â  Â  }));

Â  Â  Â  Â  const response = await fetch(API_URL, {
Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  headers: {
Â  Â  Â  Â  Â  Â  'Content-Type': 'application/json',
Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  body: JSON.stringify({Â 
Â  Â  Â  Â  Â  Â  message,
Â  Â  Â  Â  Â  Â  history: recentHistory
Â  Â  Â  Â  Â  }),
Â  Â  Â  Â  });

Â  Â  Â  Â  const data = await response.json();
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Remove typing indicator
Â  Â  Â  Â  hideTyping();

Â  Â  Â  Â  if (data.success) {
Â  Â  Â  Â  Â  addMessage(data.response, false);
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  // Show metadata if available
Â  Â  Â  Â  Â  if (data.metadata) {
Â  Â  Â  Â  Â  Â  console.log('ğŸ“Š Response metadata:', data.metadata);
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  addMessage('âŒ Sorry, something went wrong. Please try again.', false);
Â  Â  Â  Â  Â  console.error('API Error:', data.error);
Â  Â  Â  Â  Â  showStatus('Error: ' + data.error, true);
Â  Â  Â  Â  }
Â  Â  Â  } catch (error) {
Â  Â  Â  Â  hideTyping();
Â  Â  Â  Â  addMessage('âŒ Could not connect to server. Make sure the backend is running!', false);
Â  Â  Â  Â  console.error('Network Error:', error);
Â  Â  Â  Â  showStatus('Connection error - check if backend is running', true);
Â  Â  Â  } finally {
Â  Â  Â  Â  // Re-enable input
Â  Â  Â  Â  isWaitingForResponse = false;
Â  Â  Â  Â  sendButton.disabled = false;
Â  Â  Â  Â  messageInput.disabled = false;
Â  Â  Â  Â  messageInput.focus();
Â  Â  Â  }
Â  Â  }

Â  Â  // Send suggestion
Â  Â  window.sendSuggestion = function(text) { // Make function globally accessible
Â  Â  Â  messageInput.value = text;
Â  Â  Â  sendMessage(text);
Â  Â  }

Â  Â  // Event Listeners
Â  Â  sendButton.addEventListener('click', () => {
Â  Â  Â  sendMessage(messageInput.value);
Â  Â  });

Â  Â  messageInput.addEventListener('keypress', (e) => {
Â  Â  Â  if (e.key === 'Enter' && !e.shiftKey) {
Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  sendMessage(messageInput.value);
Â  Â  Â  }
Â  Â  });

Â  Â  // Keyboard shortcuts
Â  Â  document.addEventListener('keydown', (e) => {
Â  Â  Â  // Ctrl+Shift+C to clear chat
Â  Â  Â  if (e.ctrlKey && e.shiftKey && e.key === 'C') {
Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  clearChat();
Â  Â  Â  }
Â  Â  Â  // Ctrl+Shift+E to export chat
Â  Â  Â  if (e.ctrlKey && e.shiftKey && e.key === 'E') {
Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  exportChat();
Â  Â  Â  }
Â  Â  });

Â  Â  // Load chat history on page load
Â  Â  loadChatHistory();

Â  Â  // Focus input on load
Â  Â  messageInput.focus();

Â  Â  console.log('ğŸš€ KageAI Frontend loaded!');
Â  Â  console.log('ğŸ’¡ Keyboard shortcuts:');
Â  Â  console.log('Â  Â Ctrl+Shift+C: Clear chat');
Â  Â  console.log('Â  Â Ctrl+Shift+E: Export chat');
Â  Â  console.log('Â  Â Enter: Send message');
Â  </script>
</body>
</html>
